{#-
# Copyright The OpenTelemetry Authors
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#}
{%- import 'common.j2' as common -%}
{{- common.file_header() }}

module OpenTelemetry
  module SDK
    module Metrics
      module OTelMetrics
        # @!group SDK Metrics
      {% for metric in ctx.metrics %}
        {%- set const_name = metric.metric_name | screaming_snake_case %}
        {{ [metric.brief,
            concat_if("\n", metric.note),
            concat_if("\nInstrument: ", metric.instrument),
            concat_if("\nUnit: ", metric.unit),
            concat_if("\n@note Stability Level: ", metric.stability),
            ] | comment(indent=8) }}
        {%- if metric is deprecated %}
        {{ concat_if("\n@deprecated ", metric.deprecated) | comment(indent=8)}}
        {%- endif %}
        {{ const_name }} = '{{ metric.metric_name }}'

        {%- set metric_name = metric.metric_name | replace(".", "_") %}
        {%- set instrument_type = metric.instrument | replace("gauge", "observable_gauge") %}
        {%- if metric.instrument == "gauge" %}
        def self.create_{{ metric_name }}(meter, callbacks = nil)
          meter.create_observable_gauge(
            name: {{ const_name }},
            callbacks: callbacks,
            description: '{{ metric.brief | escape }}',
            unit: '{{ metric.unit }}'
          )
        end
        {%- else %}
        def self.create_{{ metric_name }}(meter)
          meter.create_{{ metric.instrument | replace("updowncounter", "up_down_counter") }}(
            name: {{ const_name }},
            description: '{{ metric.brief | escape }}',
            unit: '{{ metric.unit }}'
          )
        end
        {%- endif %}

      {% endfor %}
        # @!endgroup
      end
    end
  end
end
